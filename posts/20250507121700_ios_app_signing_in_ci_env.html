<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS App Signing and Certificates Management in CI Environment</title>
    <meta name="description" content="A comprehensive guide to managing iOS app signing certificates and provisioning profiles in a CI environment. Learn about certificate creation, profile management, and automated deployment workflows.">
    <meta name="keywords" content="ios, app signing, certificates, provisioning profiles, ci, github actions, xcode, flutter, mobile development">
    <meta name="author" content="Åndrei Makarov">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="iOS App Signing and Certificates Management in CI Environment">
    <meta property="og:description" content="A comprehensive guide to managing iOS app signing certificates and provisioning profiles in a CI environment.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://amkisko.github.io/posts/20250507121700_ios_app_signing_in_ci_env.html">
    <meta property="article:published_time" content="2024-05-07T12:17:00+00:00">
    <meta property="article:modified_time" content="2024-05-07T12:17:00+00:00">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="iOS App Signing and Certificates Management in CI Environment">
    <meta name="twitter:description" content="A comprehensive guide to managing iOS app signing certificates and provisioning profiles in a CI environment.">
    <link rel="stylesheet" href="../styles/posts_text.css">
    <link rel="stylesheet" href="../styles/posts_navigation.css">
    <style>
        .attention {
            background: #fff9e6;
            border-left: 4px solid #8b7355;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .attention strong {
            color: #6b5a42;
        }
    </style>
</head>
<body>
    <a href="../posts.html" id="map-link" title="Map"></a>
    <article>
        <h1>iOS App Signing and Certificates Management in CI Environment</h1>
        <div class="date">May 7, 2024</div>

        <p>Managing iOS app signing certificates and provisioning profiles in a CI environment can be challenging. This guide will walk you through the process of setting up and maintaining certificates for automated builds, with a focus on Flutter applications.</p>

        <div class="attention">
            <strong>Important:</strong> Always perform certificate operations from the same machine. Certificates are sensitive and transferring them between machines can cause issues.
        </div>

        <h2>Certificate Creation and Management</h2>
        <p>When working with iOS certificates, there are several key points to remember:</p>

        <div class="attention">
            <strong>Attention:</strong> Do not create certificates at https://developer.apple.com/account/resources/certificates/list. Always use Xcode instead.
        </div>

        <p>To create a new certificate:</p>
        <ol>
            <li>Open Xcode</li>
            <li>Go to Xcode → Settings → Accounts</li>
            <li>Select your Apple Developer account</li>
            <li>Click "Manage Certificates"</li>
            <li>Click "+" and select "Apple Distribution"</li>
        </ol>

        <h2>Exporting Certificates</h2>
        <p>To export your certificate and private key:</p>
        <ol>
            <li>Open Keychain Access (Applications → Utilities → Keychain Access)</li>
            <li>Select the "login" keychain</li>
            <li>Find your "Apple Distribution" certificate</li>
            <li>Right-click and select "Export"</li>
            <li>Save as a .p12 file (e.g., MyApp_2025.p12)</li>
        </ol>

        <div class="attention">
            <strong>Security Note:</strong> When importing certificates in CI, always use the <code>-t agg</code> flag as we're importing a p12 file containing both certificate and private key.
        </div>

        <h2>Flutter Workflow</h2>
        <p>Before proceeding with any build operations, ensure your Flutter environment is up to date:</p>
        <pre><code>flutter upgrade
flutter pub get && flutter pub upgrade
flutter clean && flutter pub cache clean
flutter build ios</code></pre>

        <h2>Managing Certificates in CI</h2>
        <p>Here's a script to import certificates from 1Password in your CI environment:</p>
        <pre><code>op_vault="MyApp"
op_document="MyApp AppStore Certificate Profiles $YEAR"
op_item_id=$(op item list --vault "$op_vault" | grep "$op_document" | awk '{print $1}')
tmp_path="/tmp/myapp_certs_$(date +%Y%m%d)"
mkdir -p $tmp_path
tmp_p12_path="$tmp_path/profile.p12"
p12_base64=$(op item get $op_item_id --field "$p12_filename" --reveal)
p12_password=$(op item get $op_item_id --field "password" --reveal)
echo "$p12_base64" | base64 --decode > $tmp_p12_path
security import $tmp_p12_path -P "$p12_password" -A -t agg -k ~/Library/Keychains/login.keychain-db
rm -rf $tmp_path</code></pre>

        <h2>GitHub Actions Integration</h2>
        <p>For automated builds, you'll need to set up GitHub Actions secrets:</p>
        <ol>
            <li>Store your certificate in GitHub Secrets as base64</li>
            <li>Store the certificate password</li>
            <li>Store the provisioning profile</li>
        </ol>

        <p>Here's how to update GitHub Actions secrets:</p>
        <pre><code>#!/bin/bash
# Update GitHub Actions secrets
# Replace myorg/myapp with your GitHub repository
# Replace MyApp with your app name
# Replace YEAR with current year (e.g., 2024)

YEAR=$(date +%Y)
github_repo="myorg/myapp"
github_dev_env="Flutter iPhone dev"
github_production_env="Flutter iPhone production"

op_vault="MyApp"
op_document="MyApp AppStore Certificate Profiles $YEAR"
op_item_id=$(op item list --vault "$op_vault" | grep "$op_document" | awk '{print $1}')

p12_filename="MyApp_$YEAR.p12"
dev_profile_filename="MyApp_dev_$YEAR.mobileprovision"
production_profile_filename="MyApp_production_$YEAR.mobileprovision"

p12_base64=$(op item get $op_item_id --field "$p12_filename" --reveal)
p12_password=$(op item get $op_item_id --field "password" --reveal)
dev_profile_base64=$(op item get $op_item_id --field "$dev_profile_filename" --reveal)
production_profile_base64=$(op item get $op_item_id --field "$production_profile_filename" --reveal)

# Update development environment secrets
gh secret set IOS_BUILD_CERTIFICATE_BASE64 --repo "$github_repo" --body "$p12_base64" --env "$github_dev_env"
gh secret set IOS_BUILD_CERTIFICATE_P12_PASSWORD --repo "$github_repo" --body "$p12_password" --env "$github_dev_env"
gh secret set IOS_BUILD_PROVISION_PROFILE_BASE64 --repo "$github_repo" --body "$dev_profile_base64" --env "$github_dev_env"

# Update production environment secrets
gh secret set IOS_BUILD_CERTIFICATE_BASE64 --repo "$github_repo" --body "$p12_base64" --env "$github_production_env"
gh secret set IOS_BUILD_CERTIFICATE_P12_PASSWORD --repo "$github_repo" --body "$p12_password" --env "$github_production_env"
gh secret set IOS_BUILD_PROVISION_PROFILE_BASE64 --repo "$github_repo" --body "$production_profile_base64" --env "$github_production_env"</code></pre>

        <h2>Building the App</h2>
        <p>To build the app, you might need to clean the environment first:</p>
        <pre><code>pod install --repo-update
flutter clean && flutter pub cache clean
flutter analyze
flutter pub get
flutter build ios</code></pre>

        <p>For creating an IPA file:</p>
        <pre><code>flutter build ipa --release \
  --export-options-plist=ios/exportOptions_${environment}.plist \
  --flavor ${environment} \
  -t lib/main_${environment}.dart</code></pre>

        <h2>Best Practices</h2>
        <ul>
            <li>Always use Xcode for certificate creation</li>
            <li>Keep certificates and profiles in a secure password manager</li>
            <li>Regularly rotate certificates before they expire</li>
            <li>Use separate certificates for development and production</li>
            <li>Implement proper error handling in CI scripts</li>
        </ul>

        <h2>GitHub Actions Workflow Configuration</h2>
        <p>Here's a complete example of a GitHub Actions workflow for building and deploying iOS apps:</p>
        <pre><code>name: __flutter-build-ios

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
      app_version:
        required: true
        type: string
      release_upload_url:
        required: false
        type: string
    outputs:
      result:
        description: Build job result code
        value: ${{ jobs.build.outputs.result }}

jobs:
  setup:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    env:
      environment: ${{ (inputs || github.event.inputs).environment }}
      app_version: ${{ (inputs || github.event.inputs).app_version }}
      release_upload_url: ${{ (inputs || github.event.inputs).release_upload_url }}
    outputs:
      environment: ${{ env.environment }}
      app_version: ${{ env.app_version || steps.variables.outputs.app_version }}
      release_upload_url: ${{ env.release_upload_url }}
      random_string: ${{ steps.variables.outputs.random_string }}
    steps:
      - uses: actions/checkout@v4
      - id: variables
        run: |
          echo "app_version=${{ env.environment }}-$(date +'%Y%m%d%H%m%S')" >> $GITHUB_OUTPUT
          echo "random_string=$(openssl rand -base64 32)" >> $GITHUB_OUTPUT

  build:
    needs: [setup]
    runs-on: macos-15
    timeout-minutes: 20
    outputs:
      result: ${{ steps.result.outputs.value }}
    environment: Flutter iOS Build ${{ needs.setup.outputs.environment }}
    env:
      IPA_MASK: MyApp*.ipa
      RELEASE_ASSET_NAME: myapp
      RELEASE_PROFILE: MyApp ${{ needs.setup.outputs.environment }}
      IPA_BUILD_PATH: build/ios/ipa
      RELEASE_FLAVOR: ${{ needs.setup.outputs.environment }}
      RELEASE_VERSION: ${{ needs.setup.outputs.app_version }}
      RELEASE_UPLOAD_URL: ${{ needs.setup.outputs.release_upload_url }}
    steps:
      - uses: actions/checkout@v4
      - name: Configure Apple certificate and provisioning profile
        env:
          IOS_BUILD_CERTIFICATE_BASE64: ${{ secrets.IOS_BUILD_CERTIFICATE_BASE64 }}
          IOS_BUILD_CERTIFICATE_P12_PASSWORD: ${{ secrets.IOS_BUILD_CERTIFICATE_P12_PASSWORD }}
          IOS_BUILD_PROVISION_PROFILE_BASE64: ${{ secrets.IOS_BUILD_PROVISION_PROFILE_BASE64 }}
          IOS_KEYCHAIN_PASSWORD: ${{ needs.setup.outputs.random_string }}
        run: |
          # Certificate and profile setup script
          set -e
          cd ios
          CERTIFICATE_PATH=$RUNNER_TEMP/build_certificate.p12
          PP_PATH=$RUNNER_TEMP/build_pp.mobileprovision
          KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db

          # Create and configure keychain
          security create-keychain -p "$IOS_KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
          security set-keychain-settings -lut 21600 $KEYCHAIN_PATH
          security unlock-keychain -p "$IOS_KEYCHAIN_PASSWORD" $KEYCHAIN_PATH

          # Import certificate
          echo -n "$IOS_BUILD_CERTIFICATE_BASE64" | base64 --decode --output $CERTIFICATE_PATH
          security import $CERTIFICATE_PATH -P "$IOS_BUILD_CERTIFICATE_P12_PASSWORD" \
            -A -t agg -k $KEYCHAIN_PATH \
            -T /usr/bin/codesign \
            -T /usr/bin/security

          # Install provisioning profile
          echo -n "$IOS_BUILD_PROVISION_PROFILE_BASE64" | base64 --decode --output $PP_PATH
          mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
          cp $PP_PATH ~/Library/MobileDevice/Provisioning\ Profiles/

          cd ..
      - name: Build IPA
        run: |
          flutter build ipa --release \
            --export-options-plist=ios/exportOptions_${RELEASE_FLAVOR}.plist \
            --flavor ${RELEASE_FLAVOR} \
            -t lib/main_${RELEASE_FLAVOR}.dart</code></pre>

        <h2>Flutter App Configuration</h2>
        <p>Here are the essential configuration files for a Flutter iOS app:</p>

        <h3>Podfile Configuration</h3>
        <pre><code># ios/Podfile
# Replace '15.0' with your minimum iOS version

platform :ios, '15.0'

ENV['COCOAPODS_DISABLE_STATS'] = 'true'

project 'Runner', {
  'Debug' => :debug,
  'Profile' => :release,
  'Release' => :release,
}

def flutter_root
  generated_xcode_build_settings_path = File.expand_path(File.join('..', 'Flutter', 'Generated.xcconfig'), __FILE__)
  unless File.exist?(generated_xcode_build_settings_path)
    raise "#{generated_xcode_build_settings_path} must exist. If you're running pod install manually, make sure flutter pub get is executed first"
  end

  File.foreach(generated_xcode_build_settings_path) do |line|
    matches = line.match(/FLUTTER_ROOT\=(.*)/)
    return matches[1].strip if matches
  end
  raise "FLUTTER_ROOT not found in #{generated_xcode_build_settings_path}. Try deleting Generated.xcconfig, then run flutter pub get"
end

require File.expand_path(File.join('packages', 'flutter_tools', 'bin', 'podhelper'), flutter_root)

flutter_ios_podfile_setup

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    flutter_additional_ios_build_settings(target)

    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.0'
      config.build_settings['ENABLE_BITCODE'] = 'NO'
      config.build_settings['ARCHS'] = 'arm64'
    end
  end
end</code></pre>

        <h3>Export Options Configuration</h3>
        <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
  &lt;dict&gt;
    &lt;key&gt;destination&lt;/key&gt;
    &lt;string&gt;export&lt;/string&gt;
    &lt;key&gt;manageAppVersionAndBuildNumber&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;method&lt;/key&gt;
    &lt;string&gt;app-store-connect&lt;/string&gt;
    &lt;key&gt;signingStyle&lt;/key&gt;
    &lt;string&gt;manual&lt;/string&gt;
    &lt;key&gt;signingCertificate&lt;/key&gt;
    &lt;string&gt;Apple Distribution: My Company (XXXYYY123)&lt;/string&gt;
    &lt;key&gt;provisioningProfiles&lt;/key&gt;
    &lt;dict&gt;
      &lt;key&gt;com.myapp.ios.dev&lt;/key&gt;
      &lt;string&gt;MyApp dev&lt;/string&gt;
    &lt;/dict&gt;
    &lt;key&gt;stripSwiftSymbols&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;teamID&lt;/key&gt;
    &lt;string&gt;XXXYYY123&lt;/string&gt;
    &lt;key&gt;compileBitcode&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;uploadBitcode&lt;/key&gt;
    &lt;false/&gt;
    &lt;key&gt;uploadSymbols&lt;/key&gt;
    &lt;true/&gt;
  &lt;/dict&gt;
&lt;/plist&gt;</code></pre>

        <h3>Fastlane Configuration</h3>
        <pre><code># fastlane/Fastfile
default_platform(:ios)

platform :ios do
  lane :release do
    app_store_connect_api_key(
      key_id: options[:key_id],
      issuer_id: options[:issuer_id],
      key_content: options[:key_content],
      duration: 1_200,
      in_house: false
    )

    deliver(
      ipa: options[:ipa],
      submit_for_review: false,
      automatic_release: true,
      force: true,
      skip_metadata: true,
      skip_screenshots: true,
      submission_information: {
        add_id_info_limits_tracking: true,
        add_id_info_serves_ads: false,
        add_id_info_tracks_action: true,
        add_id_info_tracks_install: true,
        add_id_info_uses_idfa: true,
        content_rights_has_rights: true,
        content_rights_contains_third_party_content: true,
        export_compliance_platform: "ios",
        export_compliance_compliance_required: false,
        export_compliance_encryption_updated: false,
        export_compliance_app_type: nil,
        export_compliance_uses_encryption: false,
        export_compliance_is_exempt: false,
        export_compliance_contains_third_party_cryptography: false,
        export_compliance_contains_proprietary_cryptography: false
      }
    )
  end

  lane :publish_to_testflight do |options|
    app_store_connect_api_key(
      key_id: options[:key_id],
      issuer_id: options[:issuer_id],
      key_content: options[:key_content],
      duration: 1_200,
      in_house: false
    )

    upload_to_testflight(
      ipa: options[:ipa],
      reject_build_waiting_for_review: true,
      skip_waiting_for_build_processing: true,
      distribute_external: true,
      notify_external_testers: true,
      groups: options[:groups],
      changelog: options[:changelog] || "Automatic release"
    )
  end
end</code></pre>

        <div class="attention">
            <strong>Note:</strong> Each code block above is self-contained and includes necessary comments. Replace the placeholder values (like <code>MyApp</code>, <code>XXXYYY123</code>, etc.) with your actual values before using.
        </div>

        <h2>Ready-to-Use Code Snippets</h2>
        <p>Below are the essential code snippets you can copy and use in your project. Each section is self-contained and includes necessary context.</p>

        <h3>1. Import Certificate from 1Password</h3>
        <pre><code>#!/bin/bash
# Import certificate from 1Password
# Replace MyApp with your app name
# Replace YEAR with current year (e.g., 2024)

YEAR=$(date +%Y)
op_vault="MyApp"
op_document="MyApp AppStore Certificate Profiles $YEAR"
op_item_id=$(op item list --vault "$op_vault" | grep "$op_document" | awk '{print $1}')
tmp_path="/tmp/myapp_certs_$(date +%Y%m%d)"
mkdir -p $tmp_path
tmp_p12_path="$tmp_path/profile.p12"
p12_base64=$(op item get $op_item_id --field "$p12_filename" --reveal)
p12_password=$(op item get $op_item_id --field "password" --reveal)
echo "$p12_base64" | base64 --decode > $tmp_p12_path
security import $tmp_p12_path -P "$p12_password" -A -t agg -k ~/Library/Keychains/login.keychain-db
rm -rf $tmp_path</code></pre>

        <h3>2. Update GitHub Actions Secrets</h3>
        <pre><code>#!/bin/bash
# Update GitHub Actions secrets
# Replace myorg/myapp with your GitHub repository
# Replace MyApp with your app name
# Replace YEAR with current year (e.g., 2024)

YEAR=$(date +%Y)
github_repo="myorg/myapp"
github_dev_env="Flutter iPhone dev"
github_production_env="Flutter iPhone production"

op_vault="MyApp"
op_document="MyApp AppStore Certificate Profiles $YEAR"
op_item_id=$(op item list --vault "$op_vault" | grep "$op_document" | awk '{print $1}')

p12_filename="MyApp_$YEAR.p12"
dev_profile_filename="MyApp_dev_$YEAR.mobileprovision"
production_profile_filename="MyApp_production_$YEAR.mobileprovision"

p12_base64=$(op item get $op_item_id --field "$p12_filename" --reveal)
p12_password=$(op item get $op_item_id --field "password" --reveal)
dev_profile_base64=$(op item get $op_item_id --field "$dev_profile_filename" --reveal)
production_profile_base64=$(op item get $op_item_id --field "$production_profile_filename" --reveal)

# Update development environment secrets
gh secret set IOS_BUILD_CERTIFICATE_BASE64 --repo "$github_repo" --body "$p12_base64" --env "$github_dev_env"
gh secret set IOS_BUILD_CERTIFICATE_P12_PASSWORD --repo "$github_repo" --body "$p12_password" --env "$github_dev_env"
gh secret set IOS_BUILD_PROVISION_PROFILE_BASE64 --repo "$github_repo" --body "$dev_profile_base64" --env "$github_dev_env"

# Update production environment secrets
gh secret set IOS_BUILD_CERTIFICATE_BASE64 --repo "$github_repo" --body "$p12_base64" --env "$github_production_env"
gh secret set IOS_BUILD_CERTIFICATE_P12_PASSWORD --repo "$github_repo" --body "$p12_password" --env "$github_production_env"
gh secret set IOS_BUILD_PROVISION_PROFILE_BASE64 --repo "$github_repo" --body "$production_profile_base64" --env "$github_production_env"</code></pre>

        <h3>3. Flutter Build Commands</h3>
        <pre><code>#!/bin/bash
# Flutter build commands
# Replace ${environment} with your environment (e.g., dev, production)

# Clean and update
flutter upgrade
flutter pub get && flutter pub upgrade
flutter clean && flutter pub cache clean

# Build iOS app
flutter build ios

# Build IPA
flutter build ipa --release \
  --export-options-plist=ios/exportOptions_${environment}.plist \
  --flavor ${environment} \
  -t lib/main_${environment}.dart</code></pre>

        <h3>4. Podfile Configuration</h3>
        <pre><code># ios/Podfile
# Replace '15.0' with your minimum iOS version

platform :ios, '15.0'

ENV['COCOAPODS_DISABLE_STATS'] = 'true'

project 'Runner', {
  'Debug' => :debug,
  'Profile' => :release,
  'Release' => :release,
}

def flutter_root
  generated_xcode_build_settings_path = File.expand_path(File.join('..', 'Flutter', 'Generated.xcconfig'), __FILE__)
  unless File.exist?(generated_xcode_build_settings_path)
    raise "#{generated_xcode_build_settings_path} must exist. If you're running pod install manually, make sure flutter pub get is executed first"
  end

  File.foreach(generated_xcode_build_settings_path) do |line|
    matches = line.match(/FLUTTER_ROOT\=(.*)/)
    return matches[1].strip if matches
  end
  raise "FLUTTER_ROOT not found in #{generated_xcode_build_settings_path}. Try deleting Generated.xcconfig, then run flutter pub get"
end

require File.expand_path(File.join('packages', 'flutter_tools', 'bin', 'podhelper'), flutter_root)

flutter_ios_podfile_setup

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    flutter_additional_ios_build_settings(target)

    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '15.0'
      config.build_settings['ENABLE_BITCODE'] = 'NO'
      config.build_settings['ARCHS'] = 'arm64'
    end
  end
end</code></pre>

        <h3>5. Export Options Configuration</h3>
        <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
  &lt;dict&gt;
    &lt;key&gt;destination&lt;/key&gt;
    &lt;string&gt;export&lt;/string&gt;
    &lt;key&gt;manageAppVersionAndBuildNumber&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;method&lt;/key&gt;
    &lt;string&gt;app-store-connect&lt;/string&gt;
    &lt;key&gt;signingStyle&lt;/key&gt;
    &lt;string&gt;manual&lt;/string&gt;
    &lt;key&gt;signingCertificate&lt;/key&gt;
    &lt;string&gt;Apple Distribution: My Company (XXXYYY123)&lt;/string&gt;
    &lt;key&gt;provisioningProfiles&lt;/key&gt;
    &lt;dict&gt;
      &lt;key&gt;com.myapp.ios.dev&lt;/key&gt;
      &lt;string&gt;MyApp dev&lt;/string&gt;
    &lt;/dict&gt;
    &lt;key&gt;stripSwiftSymbols&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;teamID&lt;/key&gt;
    &lt;string&gt;XXXYYY123&lt;/string&gt;
    &lt;key&gt;compileBitcode&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;uploadBitcode&lt;/key&gt;
    &lt;false/&gt;
    &lt;key&gt;uploadSymbols&lt;/key&gt;
    &lt;true/&gt;
  &lt;/dict&gt;
&lt;/plist&gt;</code></pre>

        <h3>6. Fastlane Configuration</h3>
        <pre><code># fastlane/Fastfile
default_platform(:ios)

platform :ios do
  lane :release do
    app_store_connect_api_key(
      key_id: options[:key_id],
      issuer_id: options[:issuer_id],
      key_content: options[:key_content],
      duration: 1_200,
      in_house: false
    )

    deliver(
      ipa: options[:ipa],
      submit_for_review: false,
      automatic_release: true,
      force: true,
      skip_metadata: true,
      skip_screenshots: true,
      submission_information: {
        add_id_info_limits_tracking: true,
        add_id_info_serves_ads: false,
        add_id_info_tracks_action: true,
        add_id_info_tracks_install: true,
        add_id_info_uses_idfa: true,
        content_rights_has_rights: true,
        content_rights_contains_third_party_content: true,
        export_compliance_platform: "ios",
        export_compliance_compliance_required: false,
        export_compliance_encryption_updated: false,
        export_compliance_app_type: nil,
        export_compliance_uses_encryption: false,
        export_compliance_is_exempt: false,
        export_compliance_contains_third_party_cryptography: false,
        export_compliance_contains_proprietary_cryptography: false
      }
    )
  end

  lane :publish_to_testflight do |options|
    app_store_connect_api_key(
      key_id: options[:key_id],
      issuer_id: options[:issuer_id],
      key_content: options[:key_content],
      duration: 1_200,
      in_house: false
    )

    upload_to_testflight(
      ipa: options[:ipa],
      reject_build_waiting_for_review: true,
      skip_waiting_for_build_processing: true,
      distribute_external: true,
      notify_external_testers: true,
      groups: options[:groups],
      changelog: options[:changelog] || "Automatic release"
    )
  end
end</code></pre>

        <div class="attention">
            <strong>Note:</strong> Each code block above is self-contained and includes necessary comments. Replace the placeholder values (like <code>MyApp</code>, <code>XXXYYY123</code>, etc.) with your actual values before using.
        </div>

        <h2>Configuration Placeholders and Settings</h2>
        <p>When setting up your iOS app signing in CI, you'll need to replace several placeholder values with your actual configuration. Here's a detailed breakdown:</p>

        <h3>GitHub Configuration</h3>
        <div class="attention">
            <strong>GitHub Organization and Repository:</strong>
            <ul>
                <li><code>myorg/myapp</code> - Replace with your GitHub organization and repository name (e.g., <code>acme/my-awesome-app</code>)</li>
                <li><code>Flutter iPhone dev</code> - Your GitHub environment name for development builds</li>
                <li><code>Flutter iPhone production</code> - Your GitHub environment name for production builds</li>
            </ul>
        </div>

        <h3>1Password Configuration</h3>
        <div class="attention">
            <strong>1Password Vault and Document Settings:</strong>
            <ul>
                <li><code>MyApp</code> - Your 1Password vault name where certificates are stored</li>
                <li><code>MyApp AppStore Certificate Profiles $YEAR</code> - Document name pattern in 1Password (e.g., <code>MyApp AppStore Certificate Profiles 2024</code>)</li>
                <li><code>MyApp_$YEAR.p12</code> - Certificate filename pattern (e.g., <code>MyApp_2024.p12</code>)</li>
                <li><code>MyApp_dev_$YEAR.mobileprovision</code> - Development profile filename pattern</li>
                <li><code>MyApp_production_$YEAR.mobileprovision</code> - Production profile filename pattern</li>
            </ul>
        </div>

        <h3>Apple Developer Account Settings</h3>
        <div class="attention">
            <strong>Apple Developer Portal Configuration:</strong>
            <ul>
                <li><code>XXXYYY123</code> - Your Apple Developer Team ID (found in Apple Developer account)</li>
                <li><code>Apple Distribution: My Company (XXXYYY123)</code> - Your distribution certificate name</li>
                <li><code>com.myapp.ios</code> - Your app's bundle identifier</li>
                <li><code>com.myapp.ios.dev</code> - Development bundle identifier</li>
                <li><code>MyApp dev</code> - Development provisioning profile name</li>
            </ul>
        </div>

        <h3>Environment-Specific Settings</h3>
        <p>For different environments (development, staging, production), you'll need to configure:</p>
        <ul>
            <li>Separate provisioning profiles for each environment</li>
            <li>Different bundle identifiers (e.g., <code>com.myapp.ios.dev</code>, <code>com.myapp.ios.staging</code>, <code>com.myapp.ios</code>)</li>
            <li>Environment-specific export options plists</li>
            <li>Separate GitHub environments with their own secrets</li>
        </ul>

        <h3>Secret Management</h3>
        <p>Required secrets in GitHub Actions:</p>
        <ul>
            <li><code>IOS_BUILD_CERTIFICATE_BASE64</code> - Base64-encoded p12 certificate</li>
            <li><code>IOS_BUILD_CERTIFICATE_P12_PASSWORD</code> - Password for the p12 certificate</li>
            <li><code>IOS_BUILD_PROVISION_PROFILE_BASE64</code> - Base64-encoded provisioning profile</li>
            <li><code>APP_STORE_CONNECT_API_KEY_ID</code> - App Store Connect API Key ID</li>
            <li><code>APP_STORE_CONNECT_API_KEY_ISSUER_ID</code> - App Store Connect API Key Issuer ID</li>
            <li><code>APP_STORE_CONNECT_API_KEY_CONTENT</code> - App Store Connect API Key content</li>
        </ul>

        <div class="attention">
            <strong>Security Best Practices:</strong>
            <ul>
                <li>Never commit certificates or provisioning profiles to version control</li>
                <li>Use 1Password or similar secure storage for sensitive files</li>
                <li>Rotate certificates and profiles before they expire</li>
                <li>Use separate certificates for development and production</li>
                <li>Implement proper access controls in GitHub environments</li>
            </ul>
        </div>

        <h3>Example Configuration Structure</h3>
        <pre><code># 1Password structure
MyApp (Vault)
└── MyApp AppStore Certificate Profiles 2024 (Document)
    ├── MyApp_2024.p12 (Certificate)
    ├── MyApp_dev_2024.mobileprovision (Profile)
    ├── MyApp_production_2024.mobileprovision (Profile)
    └── password (Certificate password)

# GitHub Environments
Flutter iPhone dev
└── Secrets
    ├── IOS_BUILD_CERTIFICATE_BASE64
    ├── IOS_BUILD_CERTIFICATE_P12_PASSWORD
    └── IOS_BUILD_PROVISION_PROFILE_BASE64

Flutter iPhone production
└── Secrets
    ├── IOS_BUILD_CERTIFICATE_BASE64
    ├── IOS_BUILD_CERTIFICATE_P12_PASSWORD
    └── IOS_BUILD_PROVISION_PROFILE_BASE64</code></pre>

        <div class="attention">
            <strong>Note:</strong> The configuration structure above is an example. Adjust the names and structure according to your organization's naming conventions and security requirements.
        </div>

        <div class="references">
            <h3>References</h3>
            <ul>
                <li><a href="https://developer.apple.com/documentation/xcode/managing-signing-certificates">Apple Documentation: Managing Signing Certificates</a></li>
                <li><a href="https://docs.github.com/en/actions/deployment/deploying-xcode-applications">GitHub Actions: Deploying Xcode Applications</a></li>
                <li><a href="https://docs.flutter.dev/deployment/ios">Flutter: iOS Deployment</a></li>
                <li><a href="https://docs.fastlane.tools/actions/upload_to_app_store/">Fastlane: Upload to App Store</a></li>
            </ul>
        </div>
    </article>
    <a href="#" id="to-top" title="To the top"></a>

    <script src="../scripts/posts_navigation.js"></script>
</body>
</html>
